import{_ as m}from"./supabase-1a98d0a9.js";import{g as s}from"./index-f2f12b32.js";const y=s,g=async(e,r)=>e(),h=async()=>{try{const e=s(),{error:r}=await e.from("books").select("id").limit(1);return!r}catch{return!1}},k=async(e,r,i,a)=>{try{const o=s(),{dbClient:n}=await m(()=>import("./index-f2f12b32.js").then(_=>_.c),["assets/index-f2f12b32.js","assets/supabase-1a98d0a9.js","assets/vendor-decc636a.js","assets/ui-f211c0cf.js","assets/index-2759b95e.css"]),{data:t,error:u}=await o.from("verification_codes").select("*, books(id, title, author)").eq("code",e.toUpperCase()).single();if(u||!t)return{success:!1,error:"Invalid verification code"};if(t.is_used)return{success:!1,error:"This code has already been used"};const d=o.from("verification_codes").update({is_used:!0,used_by:r}).eq("code",e.toUpperCase()),f={book_verified:!0,...i?{first_name:i}:{},...a?{last_name:a}:{}},l=n.updateProfile(r,f),[p,c]=await Promise.all([d,l]);return p.error?{success:!1,error:"Error updating verification code"}:c.error?{success:!1,error:`Profile update failed: ${String(c.error)}`,verificationStatus:"code_marked_used_profile_update_failed"}:{success:!0,data:t}}catch{return{success:!1,error:"Error verifying book code"}}};export{h as c,g as e,y as g,k as v};
